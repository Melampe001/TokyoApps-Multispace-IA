# CodeCov Configuration for TokyoApps-Multispace-IA
# This file configures code coverage reporting and requirements

# Coverage target and thresholds
coverage:
  precision: 2
  round: down
  range: "70...100"
  
  status:
    # Overall project coverage
    project:
      default:
        target: 70%              # Minimum coverage target
        threshold: 5%            # Allow 5% drop before failing
        if_ci_failed: error      # Fail if CI fails
        
    # Per-patch (PR changes) coverage
    patch:
      default:
        target: 70%              # New code should have 70% coverage
        threshold: 5%
        if_ci_failed: error

    # Track changes over time
    changes:
      default:
        if_ci_failed: error

# Comment configuration for PRs
comment:
  layout: "header, diff, flags, files, footer"
  behavior: default              # Update existing comment
  require_changes: false         # Always comment
  require_base: false            # Comment even without base
  require_head: true             # Require head commit

# Flag configuration for different components
flags:
  # Go backend coverage
  go:
    paths:
      - "cmd/"
      - "internal/"
      - "lib/*.go"
      - "config/"
      - "admin/"
      - "orchestrator/"
    carryforward: true           # Keep previous coverage if not run
  
  # Python coverage
  python:
    paths:
      - "lib/*.py"
      - "agents/"
      - "SYNEMU/"
      - "simulator/"
      - "emulator/"
    carryforward: true
  
  # Dart/Flutter coverage
  dart:
    paths:
      - "app/"
      - "flutter_app/"
    carryforward: true

# Ignore paths that don't need coverage
ignore:
  - "testing/"
  - "examples/"
  - "docs/"
  - "scripts/"
  - "**/*_test.go"
  - "**/*_test.py"
  - "**/*.test.ts"
  - "**/*.test.js"
  - "**/*.spec.ts"
  - "**/*.spec.js"
  - "proto/"
  - "templates/"
  - "assets/"
  - "web/static/"
  - "**/*.pb.go"
  - "**/mock_*.go"
  - "vendor/"
  - "node_modules/"

# GitHub integration
github_checks:
  annotations: true              # Show annotations on files

# Codecov AI features
ai:
  enabled: true                  # Enable AI-powered insights

# Require CI to pass before processing coverage
require_ci_to_pass: true

# Coverage parsing
parsers:
  gcov:
    branch_detection:
      conditional: yes
      loop: yes
      method: no
      macro: no
